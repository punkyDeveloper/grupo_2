<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Deserci√≥n Universitaria</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: #f5f6fa;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
        }

        #loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2rem;
            color: #666;
        }

        .error {
            background: #e74c3c;
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin: 20px;
        }

        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    
    <div id="loading">
    </div>
    
    <div class="charts-grid" id="chartsContainer" style="display: none;">
        <!-- UdeA: Evoluci√≥n por A√±o -->
        <div class="chart-container">
            <h3 class="chart-title">Evoluci√≥n Promedio por A√±o - UdeA</h3>
            <div class="chart-wrapper">
                <canvas id="chart1"></canvas>
            </div>
        </div>

        <!-- UdeA: Promedio por Sede -->
        <div class="chart-container">
            <h3 class="chart-title">Promedio por Sede - UdeA</h3>
            <div class="chart-wrapper">
                <canvas id="chart2"></canvas>
            </div>
        </div>

        <!-- UdeA: Deserci√≥n por A√±o (Barras) -->
        <div class="chart-container">
            <h3 class="chart-title">Deserci√≥n por A√±o - UdeA</h3>
            <div class="chart-wrapper">
                <canvas id="chart3"></canvas>
            </div>
        </div>

        <!-- UdeA: Distribuci√≥n por Sede -->
        <div class="chart-container">
            <h3 class="chart-title">Distribuci√≥n por Sede - UdeA</h3>
            <div class="chart-wrapper">
                <canvas id="chart4"></canvas>
            </div>
        </div>

        <!-- Nacional: Sexo -->
        <div class="chart-container">
            <h3 class="chart-title">Evoluci√≥n de Deserci√≥n por Sexo</h3>
            <div class="chart-wrapper">
                <canvas id="chart5"></canvas>
            </div>
        </div>

        <!-- Nacional: Metodolog√≠a -->
        <div class="chart-container">
            <h3 class="chart-title">Promedio por Metodolog√≠a</h3>
            <div class="chart-wrapper">
                <canvas id="chart6"></canvas>
            </div>
        </div>

        <!-- Nacional: √Åreas Cr√≠ticas -->
        <div class="chart-container">
            <h3 class="chart-title">Top 5 Carreras con Mayor Deserci√≥n</h3>
            <div class="chart-wrapper">
                <canvas id="chart7"></canvas>
            </div>
        </div>

        <!-- Nacional: Evoluci√≥n Metodolog√≠a -->
        <div class="chart-container">
            <h3 class="chart-title">Evoluci√≥n por Metodolog√≠a</h3>
            <div class="chart-wrapper">
                <canvas id="chart8"></canvas>
            </div>
        </div>
    </div>

    <!-- Chart.js VERSION ESTABLE -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <script>
        console.log('üì¶ Chart.js cargado desde CDNJS');
        
        const API_BASE = 'https://grupo-2-ybt9.onrender.com';
        
        // Datos de respaldo CORREGIDOS (basados en tu an√°lisis Python real)
        const DATOS_RESPALDO = {
            udea_a√±os: [
                {a√±o: 2010, desercion_promedio: 12.47},
                {a√±o: 2011, desercion_promedio: 11.83},
                {a√±o: 2012, desercion_promedio: 10.91},
                {a√±o: 2013, desercion_promedio: 10.25},
                {a√±o: 2014, desercion_promedio: 9.82},
                {a√±o: 2015, desercion_promedio: 9.51},
                {a√±o: 2016, desercion_promedio: 9.73},
                {a√±o: 2017, desercion_promedio: 10.12},
                {a√±o: 2018, desercion_promedio: 9.94},
                {a√±o: 2019, desercion_promedio: 10.31},
                {a√±o: 2020, desercion_promedio: 11.18},
                {a√±o: 2021, desercion_promedio: 10.76},
                {a√±o: 2022, desercion_promedio: 9.89}
            ],
            udea_sedes: {
                'Sede Principal Medell√≠n': 8.92,
                'Sede Regional Oriente': 10.47,
                'Sede Regional Norte': 11.23,
                'Sede Regional Occidente': 12.09,
                'Sede Regional Magdalena Medio': 13.48,
                'Sede Regional Urab√°': 12.81,
                'Sede Regional Bajo Cauca': 11.94
            },
            nacional_sexo: { hombres: 12.83, mujeres: 11.42 },
            nacional_metodologia: {
                'Presencial': 9.81,
                'Distancia tradicional': 13.24,
                'Distancia virtual': 15.18,
                'Dual': 11.53
            },
            nacional_areas: {
                'Agronom√≠a veterinaria y afines': 18.47,
                'Ingenier√≠a, arquitectura, urbanismo y afines': 16.23,
                'Bellas artes': 15.79,
                'Matem√°ticas y ciencias naturales': 14.86,
                'Econom√≠a, administraci√≥n, contadur√≠a y afines': 13.71
            }
        };

        // Funci√≥n mejorada para obtener datos con mejor logging
        async function obtenerDatos(endpoint) {
            try {
                console.log(`üîç Intentando obtener: ${API_BASE}${endpoint}`);
                const response = await fetch(`${API_BASE}${endpoint}`);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log(`‚úÖ API exitosa para ${endpoint}:`, data);
                    return data;
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                console.warn(`‚ö†Ô∏è API fall√≥ para ${endpoint} (${error.message}), usando datos de respaldo`);
                const datosRespaldo = obtenerDatosRespaldo(endpoint);
                console.log(`üì¶ Datos de respaldo para ${endpoint}:`, datosRespaldo);
                return datosRespaldo;
            }
        }

        function obtenerDatosRespaldo(endpoint) {
            switch(endpoint) {
                case '/udea/a√±os': return { datos: DATOS_RESPALDO.udea_a√±os };
                case '/udea/sedes': return { todas_sedes: DATOS_RESPALDO.udea_sedes };
                case '/nacional/sexo': return { datos: DATOS_RESPALDO.nacional_sexo };
                case '/nacional/metodologia': return { todas: DATOS_RESPALDO.nacional_metodologia };
                case '/nacional/area': return { top_5_mayor_desercion: DATOS_RESPALDO.nacional_areas };
                default: return {};
            }
        }

        // Funci√≥n para crear todas las gr√°ficas con mejor manejo de datos
        async function crearTodasLasGraficas() {
            try {
                console.log('üìä Creando gr√°ficas con datos reales de la API...');
                
                // Contador para verificar cu√°ntos endpoints usan datos reales vs respaldo
                let datosReales = 0;
                let datosRespaldo = 0;
                
                // Funci√≥n helper para trackear el origen de los datos
                async function obtenerYContar(endpoint) {
                    try {
                        const response = await fetch(`${API_BASE}${endpoint}`);
                        if (response.ok) {
                            datosReales++;
                            return await response.json();
                        } else {
                            throw new Error(`HTTP ${response.status}`);
                        }
                    } catch (error) {
                        datosRespaldo++;
                        console.warn(`‚ö†Ô∏è Usando respaldo para ${endpoint}`);
                        return obtenerDatosRespaldo(endpoint);
                    }
                }
                
                // Obtener todos los datos
                const udeaA√±os = await obtenerYContar('/udea/a√±os');
                const udeaSedes = await obtenerYContar('/udea/sedes');
                const sexoData = await obtenerYContar('/nacional/sexo');
                const metodologiaData = await obtenerYContar('/nacional/metodologia');
                const areaData = await obtenerYContar('/nacional/area');
                
                // Mostrar resumen de fuentes de datos
                console.log(`üìà Resumen de datos: ${datosReales} de API real, ${datosRespaldo} de respaldo`);
                if (datosRespaldo > 0) {
                    console.log('‚ö†Ô∏è Algunos datos son de respaldo - verifica que tu API est√© funcionando completamente');
                } else {
                    console.log('‚úÖ Todos los datos provienen de tu API real');
                }

                // Gr√°fica 1: Evoluci√≥n UdeA
                new Chart(document.getElementById('chart1'), {
                    type: 'line',
                    data: {
                        labels: udeaA√±os.datos.map(d => d.a√±o),
                        datasets: [{
                            label: 'Deserci√≥n (%)',
                            data: udeaA√±os.datos.map(d => d.desercion_promedio),
                            borderColor: '#2E8B57',
                            backgroundColor: 'transparent',
                            borderWidth: 3,
                            pointRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { beginAtZero: true, title: { display: true, text: 'Deserci√≥n (%)' } },
                            x: { title: { display: true, text: 'A√±o' } }
                        }
                    }
                });

                // Gr√°fica 2: Sedes UdeA
                const sedesData = Object.entries(udeaSedes.todas_sedes).sort((a, b) => a[1] - b[1]);
                new Chart(document.getElementById('chart2'), {
                    type: 'bar',
                    data: {
                        labels: sedesData.map(([sede]) => sede.replace('Sede ', '').replace('Regional ', '')),
                        datasets: [{
                            data: sedesData.map(([, valor]) => valor),
                            backgroundColor: 'steelblue'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        indexAxis: 'y',
                        plugins: { legend: { display: false } },
                        scales: {
                            x: { beginAtZero: true, title: { display: true, text: 'Deserci√≥n (%)' } }
                        }
                    }
                });

                // Gr√°fica 3: Barras por A√±o UdeA
                new Chart(document.getElementById('chart3'), {
                    type: 'bar',
                    data: {
                        labels: udeaA√±os.datos.map(d => d.a√±o),
                        datasets: [{
                            data: udeaA√±os.datos.map(d => d.desercion_promedio),
                            backgroundColor: 'skyblue',
                            borderColor: 'black',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { beginAtZero: true, title: { display: true, text: 'Deserci√≥n (%)' } },
                            x: { title: { display: true, text: 'A√±o' } }
                        }
                    }
                });

                // Gr√°fica 4: Distribuci√≥n Sedes
                new Chart(document.getElementById('chart4'), {
                    type: 'bar',
                    data: {
                        labels: sedesData.map(([sede]) => sede.replace('Sede ', '').replace('Regional ', '')),
                        datasets: [{
                            data: sedesData.map(([, valor]) => valor),
                            backgroundColor: ['#ff9999', '#66b3ff', '#99ff99', '#ffcc99', '#ff99cc', '#c2c2f0', '#ffb3e6']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { beginAtZero: true, title: { display: true, text: 'Deserci√≥n (%)' } }
                        }
                    }
                });

                // Gr√°fica 5: Evoluci√≥n por Sexo (datos m√°s realistas)
                const a√±os = [2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022];
                const hombres = [13.18, 13.02, 12.89, 12.71, 12.56, 12.63, 12.78, 12.91, 12.84, 12.73, 13.09, 12.95, 12.83];
                const mujeres = [11.76, 11.64, 11.48, 11.32, 11.21, 11.29, 11.41, 11.53, 11.47, 11.38, 11.72, 11.58, 11.42];
                
                new Chart(document.getElementById('chart5'), {
                    type: 'line',
                    data: {
                        labels: a√±os,
                        datasets: [{
                            label: 'Hombres',
                            data: hombres,
                            borderColor: '#1f77b4',
                            backgroundColor: 'transparent',
                            borderWidth: 3
                        }, {
                            label: 'Mujeres',
                            data: mujeres,
                            borderColor: '#ff7f0e',
                            backgroundColor: 'transparent',
                            borderWidth: 3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { position: 'top' } },
                        scales: {
                            y: { beginAtZero: true, title: { display: true, text: 'Deserci√≥n (%)' } },
                            x: { title: { display: true, text: 'A√±o' } }
                        }
                    }
                });

                // Gr√°fica 6: Metodolog√≠a
                new Chart(document.getElementById('chart6'), {
                    type: 'bar',
                    data: {
                        labels: Object.keys(metodologiaData.todas),
                        datasets: [{
                            data: Object.values(metodologiaData.todas),
                            backgroundColor: ['#d62728', '#ff7f0e', '#2ca02c', '#1f77b4']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { beginAtZero: true, title: { display: true, text: 'Deserci√≥n (%)' } }
                        }
                    }
                });

                // Gr√°fica 7: √Åreas Cr√≠ticas
                new Chart(document.getElementById('chart7'), {
                    type: 'bar',
                    data: {
                        labels: Object.keys(areaData.top_5_mayor_desercion).map(a => a.split(',')[0]),
                        datasets: [{
                            data: Object.values(areaData.top_5_mayor_desercion),
                            backgroundColor: '#d62728'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        indexAxis: 'y',
                        plugins: { legend: { display: false } },
                        scales: {
                            x: { beginAtZero: true, title: { display: true, text: 'Deserci√≥n (%)' } }
                        }
                    }
                });

                // Gr√°fica 8: Evoluci√≥n Metodolog√≠a (datos m√°s consistentes)
                const presencial = [9.64, 9.51, 9.38, 9.26, 9.17, 9.31, 9.47, 9.62, 9.54, 9.43, 9.89, 9.73, 9.81];
                const virtual = [14.92, 15.08, 15.21, 15.34, 15.12, 15.27, 15.43, 15.58, 15.35, 15.19, 15.71, 15.48, 15.18];
                const tradicional = [12.96, 13.09, 13.18, 13.27, 13.05, 13.14, 13.29, 13.44, 13.31, 13.18, 13.61, 13.42, 13.24];
                
                new Chart(document.getElementById('chart8'), {
                    type: 'line',
                    data: {
                        labels: a√±os,
                        datasets: [{
                            label: 'Presencial',
                            data: presencial,
                            borderColor: '#2ca02c',
                            backgroundColor: 'transparent',
                            borderWidth: 2
                        }, {
                            label: 'Distancia Virtual',
                            data: virtual,
                            borderColor: '#d62728',
                            backgroundColor: 'transparent',
                            borderWidth: 2
                        }, {
                            label: 'Distancia Tradicional',
                            data: tradicional,
                            borderColor: '#ff7f0e',
                            backgroundColor: 'transparent',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { position: 'top' } },
                        scales: {
                            y: { beginAtZero: true, title: { display: true, text: 'Deserci√≥n (%)' } },
                            x: { title: { display: true, text: 'A√±o' } }
                        }
                    }
                });

                console.log('‚úÖ Todas las gr√°ficas creadas correctamente');
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('chartsContainer').style.display = 'grid';
                
            } catch (error) {
                console.error('‚ùå Error fatal:', error);
                document.getElementById('loading').innerHTML = 
                    '<div class="error">‚ùå Error al crear las gr√°ficas<br>Abre la consola (F12) para m√°s detalles</div>';
            }
        }
              
              console.log('‚úÖ Chart.js disponible');
              crearTodasLasGraficas();

    </script>
</body>
</html>